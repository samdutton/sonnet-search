<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

<title>Test document blah</title>

<!-- JSON poems, required by shearch.js -->
<script src="json/test.js" type="text/javascript"></script>

<script src="js/jquery-1.4.2.js" type="text/javascript"></script>
<script src="js/webDatabase.js" type="text/javascript"></script>
<script src="js/shearch.js" type="text/javascript"></script>


<script type="text/javascript">

function createScriptElement(filePath) {
    var jScript = $("<script type='text/javascript'></script>");
    scriptElement.attr("src", filePath);
}

// open the test database
// then, if necessary, insert poems into the poems table
var db = openDatabase('test', '1.0', 'Test', 2 * 1024 * 1024); // short name, version, display name, max size (made-up number...)
// if transaction is successful insert poems into table
db.transaction(function (tx) {
    tx.executeSql('DROP TABLE IF EXISTS test');
    tx.executeSql('CREATE TABLE IF NOT EXISTS test (poemIndex varchar(6), poemTitle varchar(255), lineNumber varchar(2), lineText varchar(255))',  
		[], null, queryErrorHandler); 
}, transactionErrorHandler, insertPoems);

// poems object is defined in poems.json
function insertPoems() {
    db.transaction(function(tx){
        // for each poem
        $.each(poems, function(poemIndex, poem) {
            // for each line
            $.each(poem.lines, function(lineIndex, lineText) {
                // insert row with poem number, line number and line text
                tx.executeSql('INSERT INTO poems (poemIndex, poemTitle, lineNumber, lineText) VALUES (?, ?, ?, ?)',
                    [poemIndex.toString(), poem.title, (lineIndex + 1).toString(), lineText]);
            });
        });
    });
    console.log("committed");    
}
</script>

</head>

<body>

<div id="container">

</div> <!-- container -->

</body>

</html>